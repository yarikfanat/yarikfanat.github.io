var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var MessageBox=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showBox:!1,boxPos:{}},a.class_box="msg_box",a.isCloseState=null,a.isDownMouse=!1,a.delta={},a.AnimationEnd=a.AnimationEnd.bind(a),a.ClickButton=a.ClickButton.bind(a),a.handleMouseDown=a.handleMouseDown.bind(a),a.handleMouseUp=a.handleMouseUp.bind(a),a.handleMouseMove=a.handleMouseMove.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"AnimationEnd",value:function(){this.class_box="msg_box",this.isCloseState&&this.props.render(this.isCloseState)}},{key:"componentDidMount",value:function(){void 0!==this.props.effect&&(this.class_box+=" animate__animated animate__"+this.props.effect),this.setState({showBox:!0})}},{key:"ClickButton",value:function(e){void 0!==this.props.effectOut?(this.isCloseState=e.target.textContent,this.class_box+=" animate__animated animate__"+this.props.effectOut,this.setState({showBox:!0})):this.props.render(e.target.textContent)}},{key:"handleMouseDown",value:function(e){var t=this.msgBox.getBoundingClientRect();this.delta={left:e.clientX-t.left,top:e.clientY-t.top},this.isDownMouse=!0}},{key:"handleMouseUp",value:function(){this.isDownMouse=!1}},{key:"handleMouseMove",value:function(e){if(this.isDownMouse){var t=e.clientX-this.delta.left,a=e.clientY-this.delta.top;this.class_box="msg_box1",this.setState({boxPos:{left:t,top:a}})}}},{key:"render",value:function(){var e,t,a=this;return e="confirm"==this.props.type?React.createElement("div",{className:"container_buttons"},React.createElement("button",{className:"button_yes",onClick:this.ClickButton},"Да"),React.createElement("button",{className:"button_no",onClick:this.ClickButton},"Нет")):React.createElement("div",{className:"container_button"},React.createElement("button",{onClick:this.ClickButton},"Ok")),t=React.createElement("div",{className:this.class_box,style:this.state.boxPos,onAnimationEnd:this.AnimationEnd,ref:function(e){a.msgBox=e}},React.createElement("div",{className:"upper_panel",onMouseDown:this.handleMouseDown},"Внимание"),React.createElement("div",{className:"container_text"},this.props.children),e),React.createElement("div",{className:"modal",onMouseMove:this.handleMouseMove,onMouseUp:this.handleMouseUp},this.state.showBox?t:null)}}]),t}(),ClipsAnimation=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={arrayClips:[]},a.arrayImage=[{front_video:"clips/1.mp4",back_video:"clips/6.mp4"},{front_video:"clips/2.mp4",back_video:"clips/7.mp4"},{front_video:"clips/3.mp4",back_video:"clips/8.mp4"},{front_video:"clips/4.mp4",back_video:"clips/9.mp4"},{front_video:"clips/5.mp4",back_video:"clips/10.mp4"},{front_video:"clips/1.mp4",back_video:"clips/6.mp4"}],a.animation={reverseIn:"animate__flipInY",reverseOut:"animate__flipOutY",delayIn:"animate__delay-0s",delayOut:"animate__delay-0s"},a.createClip=!1,a.front_video_reverse,a.back_video_reverse,a.indexReverse,a.arrayVideo=[],a.lastVideo,a.shiftClips=a.shiftClips.bind(a),a.createArrayClips=a.createArrayClips.bind(a),a.ReverseClip=a.ReverseClip.bind(a),a.PlayVideo=a.PlayVideo.bind(a),a.PlayVideo_=a.PlayVideo_.bind(a),a.reInitClips=a.reInitClips.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"shiftClips",value:function(){var e=this;this.arrayImage.shift(),this.arrayImage[this.arrayImage.length]=this.arrayImage[0],this.arrayVideo.forEach((function(t,a){for(var n="animation_clip"+(a+1),i=t.classList,o=0;o<i.length;o++)-1!=i[o].indexOf("animation_clip")&&t.classList.remove(i[o]);t.classList.remove(e.animation.reverseIn),t.classList.remove(e.animation.delayIn),t.classList.add(n)})),this.lastVideo=this.arrayVideo.shift(),this.arrayVideo[this.arrayVideo.length]=this.lastVideo,"IE"==this.props.ua.browser.family&&setTimeout((function(){e.reInitClips()}),3e3)}},{key:"reInitClips",value:function(){var e=this.arrayImage.length-1;this.arrayVideo[e].src=this.arrayImage[0].front_video,this.arrayVideo.forEach((function(e,t){for(var a=e.classList,n=0;n<a.length;n++)-1!=a[n].indexOf("clip")&&a[n].startsWith("clip")&&e.classList.remove(a[n]);e.classList.add("clip"+(t+1));for(n=0;n<a.length;n++)-1!=a[n].indexOf("animation_clip")&&e.classList.remove(a[n])})),"IE"==this.props.ua.browser.family&&this.PlayVideo_(this.indexReverse)}},{key:"PlayVideo_",value:function(e){var t=this;setTimeout((function(){t.ReverseClip(e,t.animation.reverseOut,t.animation.delayOut)}),1e4)}},{key:"PlayVideo",value:function(e){var t=this;this.arrayVideo[e].play().then((function(){new Promise((function(e){setTimeout((function(){e()}),1e4)})).then((function(){new Promise((function(a){t.arrayVideo[e].onanimationend=function(){a()},t.ReverseClip(e,t.animation.reverseOut,t.animation.delayOut)})).then((function(){new Promise((function(a){t.arrayVideo[e].onanimationend=function(){a()},t.arrayImage[e].front_video=t.back_video_reverse,t.arrayImage[e].back_video=t.front_video_reverse,t.arrayVideo[e].src=t.arrayImage[e].front_video,t.ReverseClip(e,t.animation.reverseIn,t.animation.delayIn)})).then((function(){t.arrayVideo[e].play().then((function(){new Promise((function(e){setTimeout((function(){e()}),1e4)})).then((function(){new Promise((function(a){t.arrayVideo[e].onanimationend=function(){a()};var n=t.arrayImage.length-1;t.arrayVideo[n].src=t.arrayImage[0].front_video,t.shiftClips()})).then((function(){t.reInitClips(),t.PlayVideo(e)}))}))}))}))}))}))}))}},{key:"createArrayClips",value:function(){var e=this,t=!1,a=!1;"IE"==this.props.ua.browser.family&&(t=!0,a=!0);var n=this.arrayImage.map((function(n,i){var o="video_img clip"+(i+1)+" animate__animated";return React.createElement("video",{key:i,className:o,autoPlay:t,loop:a,muted:!0,src:n.front_video,ref:function(t){e.video=t,e.arrayVideo[i]=e.video}})}));this.createClip=!0,this.setState({arrayClips:n})}},{key:"ReverseClip",value:function(e,t,a){var n=this;if(this.indexReverse=e,this.front_video_reverse=this.arrayImage[e].front_video,this.back_video_reverse=this.arrayImage[e].back_video,this.arrayVideo[e].classList.remove(this.animation.reverseIn),this.arrayVideo[e].classList.remove(this.animation.reverseOut),this.arrayVideo[e].classList.remove(this.animation.delayOut),this.arrayVideo[e].classList.remove(this.animation.delayIn),this.arrayVideo[e].classList.add(t),this.arrayVideo[e].classList.add(a),"IE"==this.props.ua.browser.family)if(-1!=t.indexOf("Out"))this.arrayImage[this.indexReverse].front_video=this.back_video_reverse,this.arrayImage[this.indexReverse].back_video=this.front_video_reverse,setTimeout((function(){n.arrayVideo[n.indexReverse].src=n.arrayImage[n.indexReverse].front_video}),500),setTimeout((function(){n.ReverseClip(e,n.animation.reverseIn,n.animation.delayIn)}),1e3);else{var i=this.arrayImage.length-1;this.arrayVideo[i].src=this.arrayImage[0].front_video,setTimeout((function(){n.shiftClips()}),1e4)}}},{key:"componentDidMount",value:function(){this.createArrayClips()}},{key:"componentDidUpdate",value:function(e){this.createClip&&(this.createClip=!1)}},{key:"render",value:function(){return React.createElement("div",{className:"video_block"},this.state.arrayClips)}}]),t}();function Lenta(e){for(var t,a=[],n=0;n<=34;n++)a.push(React.createElement("div",{key:n,className:"lenta_win"}));return t="up"==e.pos?"lenta":"lenta2",React.createElement("div",{className:t},a)}function BackImage(e){return void 0!==e.width&&void 0!==e.height?React.createElement("img",{src:e.photo_src,width:e.width,height:e.height,className:e.class_name}):React.createElement("img",{src:e.photo_src,className:e.class_name})}function AnimationText(e){return React.createElement("div",{className:e.class_name,id:e.text_id},e.children)}function AnimationHead(){return React.createElement("div",{className:"name_head"},React.createElement(AnimationText,{class_name:"name_head1 animate__animated animate__bounceInLeft animate__delay-1s animate__slow",text_id:"head_name1"},"Тренер"),React.createElement(AnimationText,{class_name:"name_head2 animate__animated animate__bounceInRight animate__delay-1s animate__slow",text_id:"head_name2"},"онлайн"))}function FormEntry(e){return React.createElement("div",{className:e.class_name,id:e.form_id},React.createElement("div",{className:"my_logo"},"Copyright Бойчук Ярослав"),React.createElement(InputsBlock,{onLogon:e.onLogon,onSaveData:e.onSaveData,isSaveData:e.isSaveData}))}var InputsBlock=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={login:"",password:""},a.onChangeLogin=a.onChangeLogin.bind(a),a.onChangePassword=a.onChangePassword.bind(a),a.onClickHandler=a.onClickHandler.bind(a),a.handlerKey=a.handlerKey.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"onChangePassword",value:function(e){this.setState({password:e.target.value})}},{key:"onChangeLogin",value:function(e){this.setState({login:e.target.value})}},{key:"onClickHandler",value:function(e){this.props.onLogon({user_name:this.state.login,password:this.state.password})}},{key:"handlerKey",value:function(e){13!==e.keyCode&&14!==e.keyCode||this.onClickHandler()}},{key:"render",value:function(){return React.createElement("div",{className:"input_block"},React.createElement("p",null,React.createElement("b",null,"Введите имя пользователя:")),React.createElement("input",{type:"text",id:"usr",value:this.state.login,onChange:this.onChangeLogin}),React.createElement("p",null,React.createElement("b",null,"Введите пароль:")),React.createElement("input",{type:"password",id:"pass",value:this.state.password,onChange:this.onChangePassword,onKeyUp:this.handlerKey}),React.createElement("input",{type:"button",id:"btn",value:"Подтвердить",onClick:this.onClickHandler}),React.createElement("p",null,React.createElement("input",{type:"checkbox",checked:this.props.isSaveData,id:"chk",onChange:this.props.onSaveData}),React.createElement("span",null,React.createElement("b",null,"Сохранить данные"))))}}]),t}();function Logon(e){return React.createElement("div",{className:"back"},React.createElement("div",{className:"logon_container"},React.createElement(AnimationHead,null),React.createElement(FormEntry,{form_id:"frm0",class_name:"frame",onLogon:e.onLogon,onSaveData:e.onSaveData,isSaveData:e.isSaveData})),React.createElement(Lenta,{pos:"up"}),React.createElement(ClipsAnimation,{ua:e.ua}),React.createElement(Lenta,{pos:"down"}))}var Start=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={showLogon:!1,isSaveData:!0,isMsg:!1},a.user_exist=!1,a.users=null,a.agentInfo,a.onLogon=a.onLogon.bind(a),a.onStateLogon=a.onStateLogon.bind(a),a.onSaveData=a.onSaveData.bind(a),a.checkCookie=a.checkCookie.bind(a),a.CheckUser=a.CheckUser.bind(a),a.setCookie=a.setCookie.bind(a),a.getCookie=a.getCookie.bind(a),a.getConfig=a.getConfig.bind(a),a}return _inherits(t,React.Component),_createClass(t,[{key:"componentDidMount",value:function(){var e=this.checkCookie();this.agentInfo=detect.parse(navigator.userAgent),alert(this.agentInfo.browser.family),e?this.CheckUser(e):this.onStateLogon(!0)}},{key:"CheckUser",value:function(e){var t=this,a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){t.users=JSON.parse(a.responseText);var n=t.users.usr_name.findIndex((function(t){return t==e.user_name}));if(-1!=n&&t.users.usr_pass[n]==e.password){0==t.user_exist&&t.state.isSaveData&&(t.setCookie("username",e.user_name,365),t.setCookie("password",e.password,365)),t.onStateLogon(!1);var i=t.users.usr_conf[n];null!=i&&""!=i&&t.getConfig(i,e.user_name)}else 1==t.user_exist?(document.cookie="username=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",document.cookie="password=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",t.user_exist=!1,t.onStateLogon(!0)):t.setState({isMsg:!0})}},a.open("GET","json/users.json",!0),a.send()}},{key:"getConfig",value:function(e,t){var a,n=this,i=new XMLHttpRequest;i.onreadystatechange=function(){4==i.readyState&&200==i.status&&(a=JSON.parse(i.responseText),n.props.render("none"),ReactDOM.render(React.createElement(TrainExercise,{complex:a,user_name:t}),document.getElementById("wrap")))},i.open("GET",e,!0),i.send()}},{key:"checkCookie",value:function(){var e={user_name:"",password:""};return e.password=this.getCookie("password"),e.user_name=this.getCookie("username"),this.user_exist=!1,""!=e.user_name&&(""!=e.password&&(this.user_exist=!0,e))}},{key:"setCookie",value:function(e,t,a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var i="expires="+n.toGMTString();document.cookie=e+"="+t+";"+i+";path=/"}},{key:"getCookie",value:function(e){for(var t=e+"=",a=decodeURIComponent(document.cookie).split(";"),n=0;n<a.length;n++){for(var i=a[n];" "==i.charAt(0);)i=i.substring(1);if(0==i.indexOf(t))return i.substring(t.length,i.length)}return""}},{key:"onStateLogon",value:function(e){this.setState({showLogon:e})}},{key:"onLogon",value:function(e){this.CheckUser(e)}},{key:"onSaveData",value:function(e){this.setState((function(e){return{isSaveData:!e.isSaveData}}))}},{key:"render",value:function(){var e=this;return this.state.showLogon?React.createElement("div",{style:{width:"100%",height:"100%"}},React.createElement(Logon,{onLogon:this.onLogon,onSaveData:this.onSaveData,isSaveData:this.state.isSaveData,ua:this.agentInfo}),this.state.isMsg?React.createElement(MessageBox,{type:"alert",effect:"zoomInDown",render:function(){e.setState({isMsg:!1})},effectOut:"zoomOutDown"},"Имя пользователя или пароль не верны"):null):null}}]),t}();ReactDOM.render(React.createElement(Start,{render:function(e){document.getElementById("logon").style.display=e}}),document.getElementById("logon"));